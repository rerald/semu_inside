<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ë°”íƒ€ ìƒì  - ì„¸ë¬´ì¸ì‚¬ì´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .shop-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .shop-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .shop-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><polygon points="0,100 100,0 200,50 300,0 400,30 500,0 600,20 700,0 800,40 900,0 1000,20 1000,100"/></svg>');
            background-size: cover;
        }

        .shop-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .shop-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .user-info {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-points {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .points-badge {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
        }

        .shop-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: #007bff;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #007bff, #0056b3);
        }

        .tab-content {
            padding: 30px;
            min-height: 500px;
        }

        .tab-content.hidden {
            display: none;
        }

        .items-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
            gap: 25px !important;
            margin-top: 20px !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .item-card {
            background: white !important;
            border-radius: 15px !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
            overflow: hidden !important;
            transition: all 0.3s ease !important;
            border: 1px solid #e9ecef !important;
            position: relative !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 350px !important;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .item-card.highlighted {
            border: 3px solid #007bff;
            box-shadow: 0 20px 40px rgba(0, 123, 255, 0.3);
            animation: highlight-pulse 2s ease-in-out infinite;
        }

        @keyframes highlight-pulse {
            0%, 100% { 
                box-shadow: 0 20px 40px rgba(0, 123, 255, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 25px 50px rgba(0, 123, 255, 0.5);
                transform: scale(1.02);
            }
        }

        .admin-preview-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .item-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .item-image img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .rarity-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rarity-common { background: #6c757d; color: white; }
        .rarity-uncommon { background: #28a745; color: white; }
        .rarity-rare { background: #007bff; color: white; }
        .rarity-epic { background: #6f42c1; color: white; }
        .rarity-legendary { background: #ffc107; color: #212529; }

        .item-info {
            padding: 20px;
        }

        .item-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #212529;
        }

        .item-description {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .item-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-display {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ff6b6b;
        }

        .buy-button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .buy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.3);
        }

        .buy-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .owned-badge {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .inventory-item {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid #e9ecef;
            position: relative;
        }

        .inventory-item.active {
            border: 3px solid #007bff;
            box-shadow: 0 5px 20px rgba(0, 123, 255, 0.3);
        }

        .inventory-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .inventory-image img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }

        .inventory-info {
            padding: 15px;
            text-align: center;
        }

        .equip-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .equip-button.equipped {
            background: #6c757d;
            cursor: default;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.1rem;
            color: #6c757d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-button {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #495057;
        }

        .empty-state p {
            font-size: 1rem;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .shop-container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .shop-header {
                padding: 20px;
            }
            
            .shop-title {
                font-size: 2rem;
            }
            
            .user-info {
                padding: 15px 20px;
                flex-direction: column;
                align-items: stretch;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* êµ¬ë§¤ í™•ì¸ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
        }

        .modal h3 {
            color: #212529;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .modal p {
            color: #6c757d;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-button {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .confirm-button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .cancel-button {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="shop-container">
        <!-- í—¤ë” -->
        <div class="shop-header">
            <h1 class="shop-title">ğŸ­ ì•„ë°”íƒ€ ìƒì </h1>
            <p class="shop-subtitle">ë‚˜ë§Œì˜ íŠ¹ë³„í•œ ì•„ë°”íƒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ -->
        <div class="user-info">
            <div class="user-points">
                <span>ğŸ’° ë‚´ í¬ì¸íŠ¸:</span>
                <div class="points-badge" id="userPointsDisplay">
                    ë¡œë”© ì¤‘...
                </div>
            </div>
            <a href="profile.html" class="back-button">
                â† í”„ë¡œí•„ë¡œ ëŒì•„ê°€ê¸°
            </a>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="shop-tabs">
            <button class="tab-button active" onclick="switchTab('shop')">
                ğŸ›’ ìƒì 
            </button>
            <button class="tab-button" onclick="switchTab('inventory')">
                ğŸ‘¤ ë‚´ ì•„ë°”íƒ€
            </button>
        </div>

        <!-- ìƒì  íƒ­ -->
        <div id="shop-tab" class="tab-content">
            <div id="shop-loading" class="loading">
                ì•„ë°”íƒ€ ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
            </div>
            <div id="shop-items" class="items-grid">
                <!-- ì•„ë°”íƒ€ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì¸ë²¤í† ë¦¬ íƒ­ -->
        <div id="inventory-tab" class="tab-content hidden">
            <div id="inventory-loading" class="loading">
                ë‚´ ì•„ë°”íƒ€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
            </div>
            <div id="inventory-items" class="inventory-grid" style="display: none;">
                <!-- ë³´ìœ í•œ ì•„ë°”íƒ€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- êµ¬ë§¤ í™•ì¸ ëª¨ë‹¬ -->
    <div id="purchaseModal" class="modal">
        <div class="modal-content">
            <h3>ì•„ë°”íƒ€ êµ¬ë§¤ í™•ì¸</h3>
            <p id="purchaseModalText"></p>
            <div class="modal-buttons">
                <button class="modal-button confirm-button" onclick="confirmPurchase()">
                    êµ¬ë§¤í•˜ê¸°
                </button>
                <button class="modal-button cancel-button" onclick="closePurchaseModal()">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="assets/js/common.js"></script>
    <script>
        class AvatarShop {
            constructor() {
                this.currentUser = null;
                this.userPoints = 0;
                this.avatarItems = [];
                this.userAvatars = [];
                this.currentActiveAvatar = null;
                this.selectedPurchaseItem = null;
                
                this.init();
            }

            async init() {
                try {
                    console.log('ğŸ›’ ì•„ë°”íƒ€ ìƒì  ì´ˆê¸°í™” ì‹œì‘');
                    
                    // SemuApp ì´ˆê¸°í™” ëŒ€ê¸°
                    await this.waitForSemuApp();
                    
                    // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
                    await this.checkAuth();
                    
                    // ë°ì´í„° ë¡œë“œ
                    await this.loadUserPoints();
                    await this.loadAvatarItems();
                    await this.loadUserAvatars();
                    
                    console.log('âœ… ì•„ë°”íƒ€ ìƒì  ì´ˆê¸°í™” ì™„ë£Œ');
            
            // ê°•ì œ í‘œì‹œ ë³´ì¥
            setTimeout(() => {
                this.forceDisplayAvatars();
            }, 1000);
                    
                } catch (error) {
                    console.error('âŒ ì•„ë°”íƒ€ ìƒì  ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    
                    // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                    const shopLoading = document.getElementById('shop-loading');
                    const inventoryLoading = document.getElementById('inventory-loading');
                    
                    const errorMessage = `
                        <div class="empty-state">
                            <h3>âŒ ì´ˆê¸°í™” ì˜¤ë¥˜</h3>
                            <p>${error.message || 'ì•„ë°”íƒ€ ìƒì ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</p>
                            <button onclick="location.reload()" class="modal-button confirm-button">
                                í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    `;
                    
                    if (shopLoading) shopLoading.innerHTML = errorMessage;
                    if (inventoryLoading) inventoryLoading.innerHTML = errorMessage;
                }
            }

            async waitForSemuApp() {
                let attempts = 0;
                const maxAttempts = 100; // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
                
                while (attempts < maxAttempts) {
                    // SemuAppê³¼ supabaseClientê°€ ëª¨ë‘ ì¡´ì¬í•˜ê³ , ì´ˆê¸°í™”ê°€ ì™„ë£Œëœ ìƒíƒœì¸ì§€ í™•ì¸
                    if (window.semuApp && 
                        window.semuApp.supabaseClient && 
                        window.semuApp.initComplete !== false) {
                        
                        console.log('âœ… SemuApp ì´ˆê¸°í™” ì™„ë£Œ í™•ì¸');
                        
                        // ì¶”ê°€ë¡œ checkAuthStateê°€ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸
                        if (attempts > 10) { // ìµœì†Œ 1ì´ˆëŠ” ëŒ€ê¸°
                            // ì¸ì¦ ìƒíƒœë¥¼ í•œë²ˆ ë” í™•ì¸
                            try {
                                await window.semuApp.checkAuthState();
                            } catch (error) {
                                console.warn('âš ï¸ ì¸ì¦ ìƒíƒœ ì¬í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                            }
                        }
                        
                        return;
                    }
                    
                    console.log(`â³ SemuApp ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘... (${attempts + 1}/${maxAttempts})`);
                    if (window.semuApp) {
                        console.log('   - SemuApp ì¡´ì¬:', !!window.semuApp);
                        console.log('   - supabaseClient ì¡´ì¬:', !!window.semuApp.supabaseClient);
                        console.log('   - currentUser ì¡´ì¬:', !!window.semuApp.currentUser);
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                // íƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ ìˆ˜ë™ ì´ˆê¸°í™” ì‹œë„
                console.warn('âš ï¸ SemuApp ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ, ìˆ˜ë™ ì´ˆê¸°í™” ì‹œë„');
                
                if (!window.semuApp) {
                    // SemuAppì´ ì—†ìœ¼ë©´ ìƒì„±
                    window.semuApp = new SemuApp();
                    await window.semuApp.init();
                }
                
                if (!window.semuApp.supabaseClient) {
                    console.error('âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨');
                    throw new Error('Supabase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
            }

            async checkAuth() {
                console.log('ğŸ” ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...');
                
                // SemuAppì˜ í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸
                this.currentUser = window.semuApp.currentUser;
                console.log('ğŸ“‹ SemuApp.currentUser:', this.currentUser);
                
                // ë§Œì•½ currentUserê°€ ì—†ë‹¤ë©´, Supabase ì„¸ì…˜ì—ì„œ ì§ì ‘ í™•ì¸
                if (!this.currentUser) {
                    console.log('âš ï¸ SemuApp.currentUserê°€ ì—†ìŒ, Supabase ì„¸ì…˜ ì§ì ‘ í™•ì¸');
                    
                    try {
                        const { data: { session }, error } = await window.semuApp.supabaseClient.auth.getSession();
                        
                        if (error) {
                            console.error('âŒ ì„¸ì…˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
                            throw error;
                        }
                        
                        if (session && session.user) {
                            console.log('âœ… Supabase ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ë°œê²¬:', session.user.email);
                            
                            // í”„ë¡œí•„ ì •ë³´ ì¡°íšŒ
                            const { data: profile, error: profileError } = await window.semuApp.supabaseClient
                                .from('profiles')
                                .select('*')
                                .eq('id', session.user.id)
                                .single();
                            
                            if (profileError) {
                                console.error('âŒ í”„ë¡œí•„ ì¡°íšŒ ì‹¤íŒ¨:', profileError);
                                throw profileError;
                            }
                            
                            // currentUser ì„¤ì •
                            this.currentUser = {
                                id: session.user.id,
                                email: session.user.email,
                                ...profile
                            };
                            
                            // SemuAppì˜ currentUserë„ ì—…ë°ì´íŠ¸
                            window.semuApp.currentUser = this.currentUser;
                            
                            console.log('âœ… ì‚¬ìš©ì ì •ë³´ ë³µì› ì™„ë£Œ:', this.currentUser.email);
                        } else {
                            console.log('âŒ ìœ íš¨í•œ ì„¸ì…˜ì´ ì—†ìŒ');
                            throw new Error('ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        console.error('âŒ ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨:', error);
                        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = 'login.html';
                        return;
                    }
                }
                
                console.log('âœ… ì‚¬ìš©ì ì¸ì¦ í™•ì¸:', this.currentUser.email);
            }

            async loadUserPoints() {
                try {
                    const { data, error } = await window.semuApp.supabaseClient
                        .from('user_points')
                        .select('points')
                        .eq('user_id', this.currentUser.id)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        throw error;
                    }

                    this.userPoints = data?.points || 0;
                    this.updatePointsDisplay();
                    
                    console.log('ğŸ’° ì‚¬ìš©ì í¬ì¸íŠ¸ ë¡œë“œ:', this.userPoints);
                } catch (error) {
                    console.error('âŒ í¬ì¸íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.userPoints = 0;
                    this.updatePointsDisplay();
                }
            }

            updatePointsDisplay() {
                const pointsDisplay = document.getElementById('userPointsDisplay');
                pointsDisplay.textContent = `${this.userPoints.toLocaleString()}P`;
            }

            async loadAvatarItems() {
                try {
                    console.log('ğŸ­ ì•„ë°”íƒ€ ì•„ì´í…œ ë¡œë“œ ì¤‘...');
                    
                    const { data, error } = await window.semuApp.supabaseClient
                        .from('avatar_items')
                        .select('*')
                        .eq('is_active', true)
                        .order('rarity', { ascending: true })
                        .order('price', { ascending: true });

                    if (error) {
                        console.error('ğŸ”¥ Supabase ì˜¤ë¥˜:', error);
                        
                        if (error.code === '42P01') {
                            throw new Error('ì•„ë°”íƒ€ ì‹œìŠ¤í…œì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”. (í…Œì´ë¸” ëˆ„ë½)');
                        } else if (error.code === 'PGRST301') {
                            throw new Error('ì•„ë°”íƒ€ ë°ì´í„°ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                        } else {
                            throw error;
                        }
                    }

                    this.avatarItems = data || [];
                    console.log('âœ… ì•„ë°”íƒ€ ì•„ì´í…œ ë¡œë“œ ì™„ë£Œ:', this.avatarItems.length, 'ê°œ');
                    
                    if (this.avatarItems.length === 0) {
                        console.warn('âš ï¸ ì•„ë°”íƒ€ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤. ìƒ˜í”Œ ë°ì´í„°ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    }
                    
                    await this.renderShopItems();
                    
                } catch (error) {
                    console.error('âŒ ì•„ë°”íƒ€ ì•„ì´í…œ ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.showError(`ì•„ë°”íƒ€ ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                }
            }

            async loadUserAvatars() {
                try {
                    console.log('ğŸ‘¤ ì‚¬ìš©ì ì•„ë°”íƒ€ ë¡œë“œ ì¤‘...');
                    
                    const { data, error } = await window.semuApp.supabaseClient
                        .from('user_avatars')
                        .select(`
                            *,
                            avatar_items (*)
                        `)
                        .eq('user_id', this.currentUser.id);

                    if (error) throw error;

                    this.userAvatars = data || [];
                    
                    // í™œì„± ì•„ë°”íƒ€ ì°¾ê¸°
                    this.currentActiveAvatar = this.userAvatars.find(ua => ua.is_active);
                    
                    console.log('âœ… ì‚¬ìš©ì ì•„ë°”íƒ€ ë¡œë“œ ì™„ë£Œ:', this.userAvatars.length, 'ê°œ');
                    console.log('ğŸ¯ í™œì„± ì•„ë°”íƒ€:', this.currentActiveAvatar?.avatar_items?.name);
                    
                    await this.renderInventoryItems();
                    
                } catch (error) {
                    console.error('âŒ ì‚¬ìš©ì ì•„ë°”íƒ€ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }

            async renderShopItems() {
                const container = document.getElementById('shop-items');
                const loading = document.getElementById('shop-loading');
                
                console.log('ğŸ¨ ì•„ë°”íƒ€ ë Œë”ë§ ì‹œì‘:', {
                    avatarItems: this.avatarItems.length,
                    container: !!container,
                    loading: !!loading
                });
                
                if (!container) {
                    console.error('âŒ shop-items ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return;
                }
                
                if (this.avatarItems.length === 0) {
                    console.log('âš ï¸ ì•„ë°”íƒ€ ì•„ì´í…œì´ ì—†ìŒ');
                    loading.innerHTML = `
                        <div class="empty-state">
                            <h3>ğŸ›’ ìƒí’ˆ ì¤€ë¹„ ì¤‘</h3>
                            <p>ê³§ ë©‹ì§„ ì•„ë°”íƒ€ë“¤ì´ ì…ê³ ë  ì˜ˆì •ì…ë‹ˆë‹¤!</p>
                        </div>
                    `;
                    return;
                }

                // URL í•´ì‹œì—ì„œ í•˜ì´ë¼ì´íŠ¸í•  ì•„ë°”íƒ€ ID ì¶”ì¶œ
                const highlightAvatarId = window.location.hash.replace('#avatar-', '');
                
                // ì´ë¯¸ ë³´ìœ í•œ ì•„ë°”íƒ€ ID ëª©ë¡
                const ownedItemIds = this.userAvatars.map(ua => ua.avatar_item_id);
                
                console.log('ğŸ¨ ë Œë”ë§ ë°ì´í„°:', {
                    highlightAvatarId,
                    ownedItemIds,
                    avatarItems: this.avatarItems.map(item => ({ id: item.id, name: item.name, price: item.price }))
                });

                const htmlContent = this.avatarItems.map(item => {
                    const isOwned = ownedItemIds.includes(item.id);
                    const canAfford = this.userPoints >= item.price;
                    const isHighlighted = item.id === highlightAvatarId;
                    
                    console.log(`ğŸ¨ ì•„ë°”íƒ€ "${item.name}" ë Œë”ë§:`, {
                        id: item.id,
                        isOwned,
                        canAfford,
                        price: item.price,
                        userPoints: this.userPoints
                    });
                    
                    return `
                        <div class="item-card ${isHighlighted ? 'highlighted' : ''}" id="avatar-${item.id}">
                            <div class="item-image">
                                <img src="${item.image_url}" alt="${item.name}" 
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9IiNGRkQ3QjciLz4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzNSIgcj0iMyIgZmlsbD0iIzMzMzMzMyIvPgo8Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIzIiBmaWxsPSIjMzMzMzMzIi8+CjxwYXRoIGQ9Ik0yNSA1MEM1NSA1MCA1NSA1MCA1NSA1MCIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K'">
                                <div class="rarity-badge rarity-${item.rarity}">
                                    ${this.getRarityText(item.rarity)}
                                </div>
                                ${isHighlighted ? '<div class="admin-preview-badge">ğŸ‘‘ ê´€ë¦¬ì ë¯¸ë¦¬ë³´ê¸°</div>' : ''}
                            </div>
                            <div class="item-info">
                                <h3 class="item-name">${item.name}</h3>
                                <p class="item-description">${item.description || 'ë©‹ì§„ ì•„ë°”íƒ€ì…ë‹ˆë‹¤.'}</p>
                                <div class="item-price">
                                    <span class="price-display">${item.price.toLocaleString()}P</span>
                                    ${isOwned ? 
                                        '<span class="owned-badge">ë³´ìœ  ì¤‘</span>' : 
                                        `<button class="buy-button" 
                                                ${!canAfford ? 'disabled' : ''}
                                                onclick="avatarShop.openPurchaseModal('${item.id}')">
                                            ${!canAfford ? 'í¬ì¸íŠ¸ ë¶€ì¡±' : 'êµ¬ë§¤í•˜ê¸°'}
                                        </button>`
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                console.log('ğŸ¨ HTML ìƒì„± ì™„ë£Œ, DOMì— ì‚½ì… ì¤‘...');
                container.innerHTML = htmlContent;
                
                // ê°•ì œë¡œ ëª¨ë“  ìŠ¤íƒ€ì¼ ì ìš©
                if (loading) {
                    loading.style.display = 'none';
                    loading.style.visibility = 'hidden';
                    loading.style.opacity = '0';
                }
                
                // ì»¨í…Œì´ë„ˆ ê°•ì œ í‘œì‹œ
                container.style.display = 'grid';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                container.style.gridTemplateColumns = 'repeat(auto-fill, minmax(280px, 1fr))';
                container.style.gap = '25px';
                container.style.marginTop = '20px';
                container.style.minHeight = '400px';
                
                // ê° ì¹´ë“œ ê°•ì œ í‘œì‹œ
                const cards = container.querySelectorAll('.item-card');
                cards.forEach((card, index) => {
                    card.style.display = 'block';
                    card.style.visibility = 'visible';
                    card.style.opacity = '1';
                    card.style.minHeight = '350px';
                    card.style.backgroundColor = 'white';
                    card.style.border = '1px solid #e9ecef';
                    card.style.borderRadius = '15px';
                    card.style.boxShadow = '0 10px 25px rgba(0,0,0,0.1)';
                    card.style.padding = '16px';
                    card.style.margin = '0';
                    console.log(`âœ… ì¹´ë“œ ${index + 1} ê°•ì œ í‘œì‹œ ì™„ë£Œ`);
                });
                
                console.log('âœ… ì•„ë°”íƒ€ ì¹´ë“œ ë Œë”ë§ ì™„ë£Œ:', {
                    containerVisible: container.style.display,
                    loadingHidden: loading ? loading.style.display : 'N/A',
                    childrenCount: container.children.length
                });
                
                // í•˜ì´ë¼ì´íŠ¸ëœ ì•„ë°”íƒ€ë¡œ ìŠ¤í¬ë¡¤
                if (highlightAvatarId) {
                    setTimeout(() => {
                        const highlightedElement = document.getElementById(`avatar-${highlightAvatarId}`);
                        if (highlightedElement) {
                            highlightedElement.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center' 
                            });
                            console.log(`ğŸ¯ "${highlightedElement.querySelector('.item-name').textContent}" ì•„ë°”íƒ€ë¡œ ìŠ¤í¬ë¡¤ ë° í•˜ì´ë¼ì´íŠ¸`);
                        }
                    }, 500);
                }
            }

            async renderInventoryItems() {
                const container = document.getElementById('inventory-items');
                const loading = document.getElementById('inventory-loading');
                
                if (this.userAvatars.length === 0) {
                    loading.innerHTML = `
                        <div class="empty-state">
                            <h3>ğŸ‘¤ ì•„ë°”íƒ€ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>ìƒì ì—ì„œ ë©‹ì§„ ì•„ë°”íƒ€ë¥¼ êµ¬ë§¤í•´ë³´ì„¸ìš”!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.userAvatars.map(userAvatar => {
                    const item = userAvatar.avatar_items;
                    const isActive = userAvatar.is_active;
                    
                    return `
                        <div class="inventory-item ${isActive ? 'active' : ''}">
                            <div class="inventory-image">
                                <img src="${item.image_url}" alt="${item.name}"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9IiNGRkQ3QjciLz4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzNSIgcj0iMyIgZmlsbD0iIzMzMzMzMyIvPgo8Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIzIiBmaWxsPSIjMzMzMzMzIi8+CjxwYXRoIGQ9Ik0yNSA1MEM1NSA1MCA1NSA1MCA1NSA1MCIgc3Ryb2tlPSIjMzMzMzMzIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K'">
                                <div class="rarity-badge rarity-${item.rarity}">
                                    ${this.getRarityText(item.rarity)}
                                </div>
                            </div>
                            <div class="inventory-info">
                                <h3 class="item-name">${item.name}</h3>
                                <p class="item-description">${item.description || 'ë©‹ì§„ ì•„ë°”íƒ€ì…ë‹ˆë‹¤.'}</p>
                                <button class="equip-button ${isActive ? 'equipped' : ''}"
                                        ${isActive ? 'disabled' : ''}
                                        onclick="avatarShop.equipAvatar('${userAvatar.id}')">
                                    ${isActive ? 'ì°©ìš© ì¤‘' : 'ì°©ìš©í•˜ê¸°'}
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                loading.style.display = 'none';
                container.style.display = 'grid';
            }

            getRarityText(rarity) {
                const rarityMap = {
                    'common': 'ì¼ë°˜',
                    'uncommon': 'ê³ ê¸‰',
                    'rare': 'í¬ê·€',
                    'epic': 'ì˜ì›…',
                    'legendary': 'ì „ì„¤'
                };
                return rarityMap[rarity] || 'ì¼ë°˜';
            }

            openPurchaseModal(itemId) {
                const item = this.avatarItems.find(item => item.id === itemId);
                if (!item) return;

                this.selectedPurchaseItem = item;
                
                const modalText = document.getElementById('purchaseModalText');
                modalText.innerHTML = `
                    <strong>${item.name}</strong>ì„(ë¥¼) <strong>${item.price.toLocaleString()}P</strong>ì— êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                    <small style="color: #6c757d;">êµ¬ë§¤ í›„ ë‚¨ì€ í¬ì¸íŠ¸: ${(this.userPoints - item.price).toLocaleString()}P</small>
                `;
                
                document.getElementById('purchaseModal').style.display = 'block';
            }

            closePurchaseModal() {
                document.getElementById('purchaseModal').style.display = 'none';
                this.selectedPurchaseItem = null;
            }

            async confirmPurchase() {
                if (!this.selectedPurchaseItem) return;

                const item = this.selectedPurchaseItem;
                
                try {
                    console.log('ğŸ’³ ì•„ë°”íƒ€ êµ¬ë§¤ ì‹œì‘:', item.name);
                    
                    // 1. í¬ì¸íŠ¸ ì°¨ê°
                    const { error: pointError } = await window.semuApp.supabaseClient
                        .rpc('subtract_user_points', {
                            target_user_id: this.currentUser.id,
                            points_to_subtract: item.price,
                            description: `ì•„ë°”íƒ€ êµ¬ë§¤: ${item.name}`
                        });

                    if (pointError) throw pointError;

                    // 2. ì•„ë°”íƒ€ ì¶”ê°€
                    const { error: avatarError } = await window.semuApp.supabaseClient
                        .from('user_avatars')
                        .insert({
                            user_id: this.currentUser.id,
                            avatar_item_id: item.id,
                            is_active: false
                        });

                    if (avatarError) throw avatarError;

                    // 3. í¬ì¸íŠ¸ ê±°ë˜ ê¸°ë¡
                    const { error: transactionError } = await window.semuApp.supabaseClient
                        .from('point_transactions')
                        .insert({
                            user_id: this.currentUser.id,
                            amount: -item.price,
                            transaction_type: 'spend',
                            description: `ì•„ë°”íƒ€ êµ¬ë§¤: ${item.name}`,
                            avatar_item_id: item.id
                        });

                    if (transactionError) throw transactionError;

                    console.log('âœ… ì•„ë°”íƒ€ êµ¬ë§¤ ì™„ë£Œ:', item.name);
                    
                    // UI ì—…ë°ì´íŠ¸
                    await this.loadUserPoints();
                    await this.loadUserAvatars();
                    await this.renderShopItems();
                    
                    this.closePurchaseModal();
                    
                    alert(`ğŸ‰ ${item.name} êµ¬ë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n'ë‚´ ì•„ë°”íƒ€' íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.`);
                    
                } catch (error) {
                    console.error('âŒ ì•„ë°”íƒ€ êµ¬ë§¤ ì‹¤íŒ¨:', error);
                    alert('êµ¬ë§¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            }

            async equipAvatar(userAvatarId) {
                try {
                    console.log('ğŸ‘• ì•„ë°”íƒ€ ì°©ìš© ì‹œì‘:', userAvatarId);
                    
                    // 1. ëª¨ë“  ì•„ë°”íƒ€ ë¹„í™œì„±í™”
                    const { error: deactivateError } = await window.semuApp.supabaseClient
                        .from('user_avatars')
                        .update({ is_active: false })
                        .eq('user_id', this.currentUser.id);

                    if (deactivateError) throw deactivateError;

                    // 2. ì„ íƒí•œ ì•„ë°”íƒ€ í™œì„±í™”
                    const { error: activateError } = await window.semuApp.supabaseClient
                        .from('user_avatars')
                        .update({ is_active: true })
                        .eq('id', userAvatarId);

                    if (activateError) throw activateError;

                    console.log('âœ… ì•„ë°”íƒ€ ì°©ìš© ì™„ë£Œ');
                    
                    // UI ì—…ë°ì´íŠ¸
                    await this.loadUserAvatars();
                    
                    alert('ì•„ë°”íƒ€ê°€ ì°©ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ­');
                    
                } catch (error) {
                    console.error('âŒ ì•„ë°”íƒ€ ì°©ìš© ì‹¤íŒ¨:', error);
                    alert('ì•„ë°”íƒ€ ì°©ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            showError(message) {
                const loading = document.getElementById('shop-loading');
                loading.innerHTML = `
                    <div class="empty-state">
                        <h3>âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        }
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const modal = document.getElementById('purchaseModal');
        if (event.target === modal) {
            avatarShop.closePurchaseModal();
        }
    }

    // ì „ì—­ í•¨ìˆ˜ë“¤
    function confirmPurchase() {
        avatarShop.confirmPurchase();
    }

    function closePurchaseModal() {
        avatarShop.closePurchaseModal();
    }

    // íƒ­ ì „í™˜ í•¨ìˆ˜
    function switchTab(tabName) {
        // íƒ­ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // íƒ­ ì½˜í…ì¸  ì—…ë°ì´íŠ¸
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        document.getElementById(tabName + '-tab').classList.remove('hidden');
    }

    // ì „ì—­ ê°•ì œ í‘œì‹œ í•¨ìˆ˜ (ì½˜ì†”ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
    function forceShowAvatars() {
        console.log('ğŸ”§ ê°•ì œ í‘œì‹œ í•¨ìˆ˜ ì‹¤í–‰ ì¤‘...');
        
        const container = document.getElementById('shop-items');
        const loading = document.getElementById('shop-loading');
        
        if (!container) {
            console.error('âŒ shop-items ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            return;
        }
        
        // ë¡œë”© ì™„ì „íˆ ìˆ¨ê¸°ê¸°
        if (loading) {
            loading.style.display = 'none';
            loading.style.visibility = 'hidden';
            loading.style.opacity = '0';
            loading.style.height = '0';
            loading.style.overflow = 'hidden';
        }
        
        // ì»¨í…Œì´ë„ˆ ê°•ì œ í‘œì‹œ
        container.style.cssText = `
            display: grid !important;
            visibility: visible !important;
            opacity: 1 !important;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
            gap: 25px !important;
            margin-top: 20px !important;
            min-height: 400px !important;
            padding: 20px !important;
            background: transparent !important;
        `;
        
        // ê° ì¹´ë“œ ê°•ì œ í‘œì‹œ
        const cards = container.querySelectorAll('.item-card');
        console.log(`ğŸ´ ë°œê²¬ëœ ì¹´ë“œ ìˆ˜: ${cards.length}`);
        
        cards.forEach((card, index) => {
            card.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                min-height: 350px !important;
                background: white !important;
                border: 1px solid #e9ecef !important;
                border-radius: 15px !important;
                box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
                padding: 16px !important;
                margin: 0 !important;
                position: relative !important;
                overflow: hidden !important;
                transition: all 0.3s ease !important;
            `;
            console.log(`âœ… ì¹´ë“œ ${index + 1} ê°•ì œ í‘œì‹œ ì™„ë£Œ`);
        });
        
        // íƒ­ ì»¨í…ì¸ ë„ í™•ì¸
        const tabContent = document.getElementById('shop-tab');
        if (tabContent) {
            tabContent.style.display = 'block';
            tabContent.style.visibility = 'visible';
            tabContent.style.opacity = '1';
            tabContent.classList.remove('hidden');
        }
        
        console.log('ğŸ¯ ê°•ì œ í‘œì‹œ ì™„ë£Œ!', {
            containerDisplay: container.style.display,
            containerVisibility: container.style.visibility,
            containerOpacity: container.style.opacity,
            cardsCount: cards.length,
            tabContentDisplay: tabContent ? tabContent.style.display : 'N/A'
        });
    }

    // ë””ë²„ê¹…ìš© í•¨ìˆ˜
    window.debugAvatarShop = function() {
        console.log('ğŸ” ì•„ë°”íƒ€ ìƒì  ë””ë²„ê¹… ì •ë³´:');
        console.log('avatarShop ì¸ìŠ¤í„´ìŠ¤:', avatarShop);
        console.log('ì•„ë°”íƒ€ ì•„ì´í…œ ìˆ˜:', avatarShop?.avatarItems?.length || 0);
        console.log('ì‚¬ìš©ì ì•„ë°”íƒ€ ìˆ˜:', avatarShop?.userAvatars?.length || 0);
        console.log('ì‚¬ìš©ì í¬ì¸íŠ¸:', avatarShop?.userPoints || 0);
        
        // DOM ìš”ì†Œ í™•ì¸
        const shopItems = document.getElementById('shop-items');
        const shopLoading = document.getElementById('shop-loading');
        console.log('shop-items ìš”ì†Œ:', {
            exists: !!shopItems,
            display: shopItems?.style.display,
            childrenCount: shopItems?.children.length || 0
        });
        console.log('shop-loading ìš”ì†Œ:', {
            exists: !!shopLoading,
            display: shopLoading?.style.display
        });
        
        if (avatarShop?.avatarItems) {
            console.log('ì•„ë°”íƒ€ ì•„ì´í…œ ëª©ë¡:', avatarShop.avatarItems);
        }
    };

    // ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ í™•ì¸ í•¨ìˆ˜
    window.checkAvatarDatabase = async function() {
        try {
            if (!window.semuApp?.supabaseClient) {
                console.error('âŒ Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ” ë°ì´í„°ë² ì´ìŠ¤ ì•„ë°”íƒ€ í…Œì´ë¸” í™•ì¸ ì¤‘...');
            
            const { data, error } = await window.semuApp.supabaseClient
                .from('avatar_items')
                .select('*')
                .limit(10);
            
            if (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨:', error);
                return;
            }
            
            console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì•„ë°”íƒ€ ì•„ì´í…œ:', data);
            console.log('ğŸ“Š ì´ ì•„ì´í…œ ìˆ˜:', data?.length || 0);
            
            if (data && data.length > 0) {
                console.log('ì²« ë²ˆì§¸ ì•„ì´í…œ:', data[0]);
            } else {
                console.warn('âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ì— ì•„ë°”íƒ€ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.');
                console.log('ğŸ’¡ í•´ê²°ì±…: avatar-shop-sample-data.sqlì„ ì‹¤í–‰í•˜ì„¸ìš”.');
            }
            
        } catch (error) {
            console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
        }
    };

    // ì•± ì´ˆê¸°í™”
    let avatarShop;
    
    document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸ­ ì•„ë°”íƒ€ ìƒì  í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        
        // ë¨¼ì € ë¡œê·¸ì¸ ìƒíƒœë¥¼ ê°„ë‹¨íˆ í™•ì¸ (localStorageì—ì„œ)
        const quickAuthCheck = () => {
            try {
                const supabaseSession = localStorage.getItem('sb-skpvtqohyspfsmvwrgoc-auth-token');
                if (!supabaseSession) {
                    console.log('âš ï¸ ì €ì¥ëœ ì¸ì¦ í† í°ì´ ì—†ìŒ, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = 'login.html';
                    return false;
                }
                return true;
            } catch (error) {
                console.warn('âš ï¸ í† í° í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                return true; // ì˜¤ë¥˜ ë°œìƒì‹œ ê³„ì† ì§„í–‰
            }
        };
        
        if (quickAuthCheck()) {
            avatarShop = new AvatarShop();
        }
    });
    </script>
</body>
</html>
